# 4. Выборочные коэффициенты ранговой корреляции Спирмена и Кендалла, их свойства. Проверка гипотез о значимости выборочных коэффициентов корреляции Спирмена и Кендалла. [[⇧]](../questions-list.md)

## Выборочные коэффициенты ранговой корреляции Спирмена и Кендалла, их свойства

**Коэффициенты ранговой корреляции Спирмена ($\rho$) и Кендалла ($\tau$)** — **непараметрическая** (независящая от предположений о типе распределения исходных данных и его параметров) мера линейной взаимосвязи между признаками, представленными в **порядковой** (ранговой) шкале.

Свойства коэффициентов ранговой корреляции:

- Для любых СВ $X$ и $Y$: $-1 \le r_{xy} \le 1$, при этом:
  - **Знак** $r_{xy}$ совпадает с **характером** связи (отрицательная или положительная).
  - Чем ближе значение $|r_{xy}|$ к $1$, тем **сильнее** линейная связь между $X$ и $Y$.
  - Значение $r_{xy}$ близкое к $0$, означает **отсутствие** линейной связи (но возможна нелинейная связь).
- Основаны не на абсолютных значениях признаков, а на **рангах**.

**Ранги** — это порядковые номера единиц наблюдения, упорядоченных по значениям исследуемого признака.

Присвоение рангов признакам:

1. Объекты выборки расположить в порядке **«возрастания»** значений признака $X$, каждому из объектов приписать **ранг** $x_{i} = i$,  
   где $i$ – **порядковый** номер объекта или **среднее арифметическое порядковых номеров** для объектов с одинаковым значением признака.

2. Объекты выборки расположить в порядке **«возрастания»** значений признака $Y$, каждому из объектов приписать **ранг** $y_{i} = i$,  
   где $i$ – **порядковый** номер объекта или **среднее арифметическое порядковых номеров** для объектов с одинаковым значением признака.
3. Получаем две последовательности рангов, причем в общем случае $x_{i} \ne y_{i}$.

Коэффициент ранговой корреляции **Спирмена**:

$$
\rho = 1 - \frac{6∑_{i=1}^nd_{i}^2}{n(n^2 - 1)}
$$

$$
d_i = x_i-y_i
$$

$n$ – объем выборки.

$x_i$, $y_i$ – ранги для признаков $X$ и $Y$.

Коэффициент ранговой корреляции **Кендалла**:

1. Расположить объекты в порядке возрастания $x_i$:
2. Обозначим:
   $$R = ∑_{i=1}^{n} R_{i}$$
   где $R_{i}$ – число рангов, больших $y_{i}$.
3. Коэффициент ранговой корреляции Кендалла равен:
   $$\tau = \frac{4R}{n(n-1)}-1$$
   где $n$ – объем выборки.

## Проверка гипотез о значимости выборочных коэффициентов корреляции Спирмена и Кендалла

### Постановка задачи

`Предположим:` Выборочный коэффициент корреляции $r_{в}$ оказался отличным от нуля.

`Вопрос:` Является ли это отличие **значимым** — означает ли оно, что коэффициент корреляции $r_{г}$ генеральной совокупности также отличен от нуля, и можно предполагать наличие линейной связи между признаками в генеральной совокупности?

`Решение:` Проверка гипотезы о значимости выборочного коэффициента корреляции:

$H_{0}: r_{г} = 0$, корреляция **отсутствует**.

$H_{1}: r_{г} \ne 0$, корреляция **существует**.

### Используемый критерий

В качестве **критерия** для проверки нулевой гипотезы используется статистика:

$$T = r_{в} \cdot \frac{\sqrt{n-2}}{\sqrt{1-r_{в}^{2}}}$$

$r_{в}$ – выборочный коэффициент ранговой корреляции.

$n$ – число наблюдений (объем выборки).

При справедливости нулевой гипотезы величина $T$ имеет **распределение Стьюдента**, с $k = n - 2$ степенями свободы.

> Поскольку конкурирующая гипотеза имеет вид $r_{г} \ne 0$, то **критическая область двусторонняя**.

### Алгоритм проверки нулевой гипотезы

1. По данным выборки найти **наблюдаемое** значение критерия:

   $$t_{набл} = r_{в} \cdot \frac{\sqrt{n-2}}{\sqrt{1-r_{в}^{2}}}$$

   $r_{в}$ – выборочный коэффициент ранговой корреляции.

   $n$ – число наблюдений (объем выборки).

2. По таблице критических точек распределения Стьюдента для выбранного уровня значимости найти **критическую точку**:

   $$t_{кр} = t_{дв.к.}(\alpha, k) = t_{дв.к.}(\alpha, n - 2)$$

   $t_{дв.к.}$ – значение двухсторонней критической области.

   $\alpha$ – уровень значимости.

   $k$ – количество степеней свободы.

3. Если:
   - $|t_{набл}| \le |t_{кр}|$, то **нет оснований отвергнуть** нулевую гипотезу.
   - $|t_{набл}| \gt |t_{кр}|$, то нулевая гипотеза **должна быть отвергнута** как противоречащая данным наблюдений.

`Пример:` Необходимо определить взаимосвязь между возрастом клиента сотовой компании, и числом звонков, совершённым им в неделю. В результате наблюдений имеем следующую таблицу:

| $i$ | $X$ (возраст) | $Y$ (число звонков) |
| --- | ------------- | ------------------- |
| 1   | 24 лет        | 12 звонков          |
| 2   | 51 лет        | 111 звонков         |
| 3   | 41 лет        | 41 звонков          |
| 4   | 35 лет        | 47 звонков          |
| 5   | 26 лет        | 58 звонков          |
| 6   | 26 лет        | 45 звонков          |
| 7   | 50 лет        | 61 звонков          |
| 8   | 66 лет        | 10 звонков          |
| 9   | 36 лет        | 34 звонков          |
| 10  | 40 лет        | 79 звонков          |

1. Количество измерений: $n = 10$
2. Выпишем значения признака $X$ в порядке «возрастания», для каждого значения найдем $x_i$ (ранг):

   > | $№$ | $X$  | $x_i$ |
   > | --- | ---- | ----- |
   > | 1   | $24$ | $1$   |
   > | 2   | $26$ | $2.5$ |
   > | 3   | $26$ | $2.5$ |
   > | 4   | $35$ | $4$   |
   > | 5   | $36$ | $5$   |
   > | 6   | $40$ | $6$   |
   > | 7   | $41$ | $7$   |
   > | 8   | $50$ | $8$   |
   > | 9   | $51$ | $9$   |
   > | 10  | $66$ | $10$  |
   >
   > Так как значение $26$ встречалось дважды его ранг равен среднему арифметическому порядковых номеров: $\frac{2+3}{2} = 2.5$

3. Выпишем значения признака $Y$ в порядке «возрастания», для каждого значения найдем $y_i$ (ранг):

   > | $№$ | $Y$   | $y_i$ |
   > | --- | ----- | ----- |
   > | 1   | $10$  | $1$   |
   > | 2   | $12$  | $2$   |
   > | 3   | $34$  | $3$   |
   > | 4   | $41$  | $4$   |
   > | 5   | $45$  | $5$   |
   > | 6   | $47$  | $6$   |
   > | 7   | $58$  | $7$   |
   > | 8   | $61$  | $8$   |
   > | 9   | $79$  | $9$   |
   > | 10  | $111$ | $10$  |

4. Найдем $d_i = x_i - y_i$

   > | $i$ | $X$  | $x_i$ | $Y$   | $y_i$ | $x_i - y_i = d_i$ |
   > | --- | ---- | ----- | ----- | ----- | ----------------- |
   > | 1   | $24$ | $1$   | $12$  | $2$   | $1-2=-1$          |
   > | 2   | $51$ | $9$   | $111$ | $10$  | $9-10=-1$         |
   > | 3   | $41$ | $7$   | $41$  | $4$   | $7-4=3$           |
   > | 4   | $35$ | $4$   | $47$  | $6$   | $4-6=-2$          |
   > | 5   | $26$ | $2.5$ | $58$  | $7$   | $2.5-7=-4.5$      |
   > | 6   | $26$ | $2.5$ | $45$  | $5$   | $2.5-5=-2.5$      |
   > | 7   | $50$ | $8$   | $61$  | $8$   | $8-8=0$           |
   > | 8   | $66$ | $10$  | $10$  | $1$   | $10-1=9$          |
   > | 9   | $36$ | $5$   | $34$  | $3$   | $5-3=2$           |
   > | 10  | $40$ | $6$   | $79$  | $9$   | $6-9=-3$          |

5. Вычисляем коэффициент ранговой корреляции Спирмена:

   $\rho = 1- \frac{ 6((-1)^2 + (-1)^2 + (3)^2 + (-2)^2 + (-4.5)^2 + (-2.5)^2 + (0)^2 + (9)^2 + (2)^2 + (-3)^2)}{10(10^2-1)} =$

   $= 1 - \frac{6(1 + 1 + 9 + 4 + 20.25 + 6.25 + 0 + 81 + 4 + 9)}{10 \cdot 99} = 1- \frac{6 \cdot 135.5}{990} = 1 - \frac{813}{990} \approx 0.18$

6. Расположим признаки в порядке возрастания $x_i$ и найдем $R_i$ число рангов больших $y_i$:

   > | $i$ | $X$  | $x_i$ | $Y$   | $y_i$ | $R_i$ |
   > | --- | ---- | ----- | ----- | ----- | ----- |
   > | 1   | $24$ | $1$   | $12$  | $2$   | $8$   |
   > | 2   | $26$ | $2.5$ | $58$  | $7$   | $3$   |
   > | 3   | $26$ | $2.5$ | $45$  | $5$   | $4$   |
   > | 4   | $35$ | $4$   | $47$  | $6$   | $3$   |
   > | 5   | $36$ | $5$   | $34$  | $3$   | $4$   |
   > | 6   | $40$ | $6$   | $79$  | $9$   | $1$   |
   > | 7   | $41$ | $7$   | $41$  | $4$   | $2$   |
   > | 8   | $50$ | $8$   | $61$  | $8$   | $1$   |
   > | 9   | $51$ | $9$   | $111$ | $10$  | $0$   |
   > | 10  | $66$ | $10$  | $10$  | $1$   | $0$   |
   >
   > Пример расчета $R_i$:
   >
   > - Под $y_i = 2$ есть $8$ значений больших $2$, это $[7, 5, 6, 3, 9, 4, 8, 10]$, значит $R_1=8$.
   > - Под $y_i = 7$ есть $3$ значения больших $7$, это $[9, 8, 10]$, значит $R_2=3$.
   > - Под $y_i = 5$ есть $4$ значения больших $5$, это $[7, 6, 9, 8, 10]$, значит $R_3=4$.

7. Вычисляем коэффициент ранговой корреляции Кендалла:

   $\tau = \frac{4(8 + 3 + 4 + 3 + 4 + 1 + 2 + 1 + 0 + 0)}{10(10-1)} - 1 = \frac{4 \cdot 26}{10 \cdot 9} - 1 = \frac{104}{90} - 1 \approx 0.16$

8. Проверка гипотезы о значимости коэффициента корреляции Спирмена:

   `Предположим:` Выборочный коэффициент корреляции $r_{в}$ оказался отличным от нуля.

   `Вопрос:` Является ли это отличие **значимым** — означает ли оно, что коэффициент корреляции $r_{г}$ генеральной совокупности также отличен от нуля, и можно предполагать наличие линейной связи между признаками в генеральной совокупности?

   `Решение:` Проверка гипотезы о значимости выборочного коэффициента корреляции:

   $H_{0}: r_{г} = 0$, корреляция **отсутствует**.

   $H_{1}: r_{г} \ne 0$, корреляция **существует**.

   Проверка гипотезы при уровне значимости $\alpha = 0.05$:

   $t_{набл} = 0.18 \cdot \frac{\sqrt{10-2}}{\sqrt{1-0.18^{2}}} \approx 0.52$

   $t_{кр} = t_{дв.к.}(0.05, 8) = 2.306$ (таблица распределения Стьюдента)

   Так как $0.52 \le 2.306$, то **нет оснований отвернуть нулевую гипотезу**, значит корреляция отсутствует.

9. Проверка гипотезы о значимости коэффициента корреляции Кендалла:

   `Предположим:` Выборочный коэффициент корреляции $r_{в}$ оказался отличным от нуля.

   `Вопрос:` Является ли это отличие **значимым** — означает ли оно, что коэффициент корреляции $r_{г}$ генеральной совокупности также отличен от нуля, и можно предполагать наличие линейной связи между признаками в генеральной совокупности?

   `Решение:` Проверка гипотезы о значимости выборочного коэффициента корреляции:

   $H_{0}: r_{г} = 0$, корреляция **отсутствует**.

   $H_{1}: r_{г} \ne 0$, корреляция **существует**.

   Проверка гипотезы при уровне значимости $\alpha = 0.05$:

   $t_{набл} = 0.16 \cdot \frac{\sqrt{10-2}}{\sqrt{1-0.16^{2}}} \approx 0.46$

   $t_{кр} = t_{дв.к.}(0.05, 8) = 2.306$ (таблица распределения Стьюдента)

   Так как $0.46 \le 2.306$, то **нет оснований отвернуть нулевую гипотезу**, значит корреляция отсутствует.
