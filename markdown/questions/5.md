# 5. Исследование взаимосвязей категориальных признаков: таблицы сопряженности; применение критерия хи-квадрат для анализа зависимости категориальных признаков; коэффициент Крамера, его свойства. [[⇧]](../questions-list.md)

## Таблицы сопряженности

**Таблицы сопряженности** — инструмент анализа для значений признаков, измеренных в **номинальной** шкале.

> Для признаков, измеренных в номинальной шкале недоступны не только числовые операции, но и упорядочивание.

Если выборка содержит $n$ наблюдений, причем:

- Для признака $X$ были зарегистрированы значения $x_1,x_2,\ldots,x_k$.
- Для признака $Y$ были зарегистрированы значения $y_1,y_2,\ldots,y_l$.

При этом пары значений $X = x_i$ и $Y = y_j$ наблюдались $n_{kl}$ раз:

| $_X / ^Y$ | $y_1$                    | $y_2$                    | $\ldots$ | $y_{l-1}$                      | $y_l$                    | $M^x$                          |
| --------- | ------------------------ | ------------------------ | -------- | ------------------------------ | ------------------------ | ------------------------------ |
| $x_1$     | $n_{1,1}$                | $n_{1,2}$                | $\ldots$ | $n_{1,l-1}$                    | $n_{1,l}$                | $M^x_1=∑_{j=1}^ln_{1,j}$       |
| $x_2$     | $n_{2,1}$                | $n_{2,2}$                | $\ldots$ | $n_{2,l-1}$                    | $n_{2,l}$                | $M^x_2=∑_{j=1}^ln_{2,j}$       |
| $\ldots$  | $\ldots$                 | $\ldots$                 | $\ldots$ | $\ldots$                       | $\ldots$                 | $\ldots$                       |
| $x_{k-1}$ | $n_{k-1,1}$              | $n_{k-1,2}$              | $\ldots$ | $n_{k-1,l-1}$                  | $n_{k-1,l}$              | $M^x_{k-1}=∑_{j=1}^ln_{k-1,j}$ |
| $x_k$     | $n_{k,1}$                | $n_{k,2}$                | $\ldots$ | $n_{k,l-1}$                    | $n_{k,l}$                | $M^x_k=∑_{j=1}^ln_{k,j}$       |
| $M^y$     | $M^y_1=∑_{i=1}^kn_{i,1}$ | $M^y_2=∑_{i=1}^kn_{i,2}$ | $\ldots$ | $M^y_{l-1}=∑_{i=1}^kn_{i,l-1}$ | $M^y_l=∑_{i=1}^kn_{i,l}$ | $n$                            |

> Величины $M^x_i$ – суммы частот по строке и $M^y_j$ – суммы частот по столбцу, называются **маргинальными частотами**.

### Постановка задачи

`Пусть:` Данные наблюдений $X$ и $Y$ представлены таблицей сопряженности, представим **гипотезы**:

$H_0:$ признаки $X$ и $Y$ **не связаны** между собой зависимостью.

$H_1:$ признаки $X$ и $Y$ **являются связанными**.

### Применение критерия хи-квадрат

Критерий $\chi^2$ позволяет оценить меру расхождения **эмпирических** $n_{ij}$ и **теоретических** $E_{ij}$ частот:

$$
\chi^2 = ∑_{i=1}^k ∑_{j=1}^l \frac{(n_{ij} - E_{ij})^2}{E_{ij}}
$$

$$
E_{ij}= \frac{1}{n} M^x_i \cdot M^y_j
$$

$n$ – объем выборки.

$n_{ij}$ – значение из $i$-той строки, $j$-того столбца.

$M^x_i$ – суммы частот по строке.

$M^y_j$ – суммы частот по столбцу.

### Алгоритм проверки нулевой гипотезы

1. По данным выборки найти **наблюдаемое** значение критерия $\chi^2$.

   $$t_{набл} = ∑_{i=1}^k ∑_{j=1}^l \frac{(n_{ij} - E_{ij})^2}{E_{ij}}$$

   $$E_{ij}= \frac{1}{n} M^x_i \cdot M^y_j$$

2. По таблице критических точек распределения $\chi^2$ для выбранного уровня значимости находим **критическую точку**:

   $$t_{кр} = t_{кр}(\alpha, v) = t_{кр}(\alpha, (k-1)(l-1))$$

   $\alpha$ – уровень значимости.

   $v$ – количество степеней свободы.

   $k$ – кол-во строк, $l$ – кол-во столбцов.

3. Если:

- $|t_{набл}| \le |t_{кр}|$, то **нет оснований отвергнуть** нулевую гипотезу.
- $|t_{набл}| \gt |t_{кр}|$, то нулевая гипотеза **должна быть отвергнута** как противоречащая данным наблюдений.

> Критерий $\chi^2$ позволяет **только проверить наличие** взаимосвязи между признаками, но не позволяет оценить силу и направленность связи.

## Коэффициент Крамера

**Коэффициент Крамера** — оценка **силы** взаимосвязи между категориальными признаками.

$$ V = \sqrt{\frac{\chi^2}{n \cdot min(k-1,l-1)}}$$

$\chi^2$ – критерий хи-квадрат.

$n$ – объем выборки.

$min(k-1,l-1)$ – минимальное из кол-во строк и столбцов минус $1$.

**Свойства** коэффициента Крамера:

- Для любых признаков $X$ и $Y$: $0 \le V \le 1$, при этом:
  - Значение, близкое к $0$ означает **отсутствие** связи между $X$ и $Y$.
  - Значение, равное $1$ означает **полное совпадение**.

> Значение коэффициента Крамера показывает только силу связи, но ничего не говорит о характере и направленности связи.

`Пример:` Необходимо определить взаимосвязь между полом человека и его отношением к мороженному. В результате измерений получаем следующую таблицу:

|             | Любит мороженное | Не любит мороженное |
| ----------- | ---------------- | ------------------- |
| **Мужской** | 30 человек       | 70 человек          |
| **Женский** | 60 человек       | 40 человек          |

1. Количество измерений: $n = 200$
2. Признак $X$ – пол, значения $x_1$ – мужской, $x_2$ – женский.
3. Признак $Y$ – отношение к мороженному, значения $x_1$ – любит, $x_2$ – не любит.
4. Построим таблицу сопряженности:

   > | $_X / ^Y$ | $y_1$        | $y_2$         | $M^x$         |
   > | --------- | ------------ | ------------- | ------------- |
   > | $x_1$     | $30$         | $70$          | $M^x_1 = 100$ |
   > | $x_2$     | $60$         | $40$          | $M^x_2 = 100$ |
   > | $M^y$     | $M^y_1 = 90$ | $M^y_2 = 110$ | $200$         |

5. Вычислим $\chi^2$:

   $E_{1,1} = \frac{1}{n}M^x_1 \cdot M^y_1 = \frac{100 \cdot 90}{200}=45$

   $E_{1,2} = \frac{1}{n}M^x_1 \cdot M^y_2 = \frac{100 \cdot 110}{200}=55$

   $E_{2,1} = \frac{1}{n}M^x_2 \cdot M^y_1 = \frac{100 \cdot 90}{200}=45$

   $E_{2,2} = \frac{1}{n}M^x_2 \cdot M^y_2 = \frac{100 \cdot 110}{200}=55$

   $\chi^2 = \frac{(n_{1,1}-E_{1,1})^2}{E_{1,1}} + \frac{(n_{1,2}-E_{1,2})^2}{E_{1,1}} + \frac{(n_{2,1}-E_{2,1})^2}{E_{1,1}} + \frac{(n_{2,2}-E_{2,2})^2}{E_{2,2}}=$

   $=\frac{(30-45)^2}{45} + \frac{(70-55)^2}{55} + \frac{(60-45)^2}{45} + \frac{(40 - 55)^2}{55} \approx 18.18$

6. Вычислим коэффициент Крамера:

   $V = \sqrt{\frac{18.18}{200 * 1}} \approx 0.30$

7. Проверка гипотез при уровне значимости $\alpha = 0.05$:

   $H_0:$ признаки $X$ и $Y$ **не связаны** между собой зависимостью.

   $H_1:$ признаки $X$ и $Y$ **являются связанными**.

   $t_{набл} = 18.18$

   Количество степеней свободы:

   $v$ = $(k-1)(l-1)=(2-1)(2-1)=1$

   $t_{кр} = t_{кр}(0.05, 1) = 3.841$ (таблица распределения хи-квадрат)

   Так как $18.18 > 3.841$, то **есть основания отвернуть нулевую гипотезу**, значит признаки являются связанными.
