# 18. Оценка принадлежности классу в задачах бинарной классификации. Метрики качества оценок принадлежности классу. [[⇧]](../questions-list.md)

## Оценка принадлежности классу в задачах бинарной классификации

Многие алгоритмы классификации работают по принципу: для объекта $x$ вычисляется некоторое вещественное число $b(x)$, которое сравнивается с пороговым значением $t$:

$$
a(x) = [b(x)> t]
$$

Где $b(x)$ – **оценка принадлежности** объекта $x$ классу $+1$, может интерпретироваться как степень уверенности, что $x$ относится к к классу $+1$.

В частности для **линейного** классификатора $a(x) =[\langle w, x \rangle > t]$ оценка принадлежности объекта $x$ классу $+1$ имеет вид:

$$
b(x) = \langle w, x \rangle
$$

В практике анализа данных часто требуется оценить **качество самой оценки принадлежности**, при этом конкретное значение порога $t$ может быть выбрано позже (исходя из ограничений на точность и/или полноту).

## Метрики качества оценок принадлежности классу

Один из широко используемых способов **оценки принадлежности классу** основан на использовании $ROC$-кривых.

Каждая точка на $ROC$-кривой соответствует классификатору с определенным значением **порога**.

### $ROC$-кривые

$ROC$-**кривые** строятся в системе координат:

- Ось **абсцисс** ($X$):

  $$
  FPR = \frac{FP}{FP + TN}
  $$

  $FPR$ – доля ложных срабатываний.

- Ось **ординат** ($Y$):

  $$
  TPR = \frac{TP}{TP + FN}
  $$

  $TPR$ – доля истинных срабатываний.

**Построение** $ROC$-кривой:

Задаются значения порога (от больших значений к меньшим) и вычисляются оценки $FPR$ и $TPR$ полученных классификаторов на рассматриваемой выборке. Каждому значению порога соответствует точка с координатами $(FPR, TPR)$.

**Свойства** $ROC$-кривой:

- **Начальная** точка: $(0, 0)$.
- **Конечная** точка: $(1,1)$.
- Для **идеального** классификатора кривая проходит через точку $(0, 1)$, чем ближе кривая к точке $(0, 1)$, тем лучше качество классификации.

### Метрика $AUC\text{-}ROC$

**Метрика** $AUC\text{-}ROC$ — площадь под $ROC$-кривой:

- Строится на основе **нормированных** значений (доли в общем объеме классов) — при изменении баланса классов значение $AUC\text{-}ROC$ **не изменится**.
- Для **идеального** классификатора значение $AUC\text{-}ROC = 1$
- Для **бесполезного** (дает случайные ответы) $AUC\text{-}ROC = 0.5$

$AUC\text{-}ROC$ — вероятность того, что для случайно выбранного (из имеющейся выборки) объекта класса $+1$ и случайно выбранного объекта класса $-1$, объект класса $+1$ получит оценку принадлежности выше, чем объект класса $-1$.

### $PR$-кривые

Другой способ оценки принадлежности классу — использование **кривых точности-полноты** (`precision-recall`):

$PR$-**кривые** строятся в системе координат:

- Ось **абсцисс** ($X$):

  $$
  precision(a,X) = \frac{TP}{TP + FP}
  $$

- Ось **ординат** ($Y$):

  $$
  recall(a,X) = \frac{TP}{TP + FN}
  $$

**Построение** $PR$-кривой:

Задаются значения порога (от больших значений к меньшим) и вычисляются оценки $precision$ и $recall$ полученных классификаторов на рассматриваемой выборке. Каждому значению порога соответствует точка с координатами $(precision, recall)$.

### Метрика $AUC\text{-}PRC$

**Метрика** $AUC\text{-}PRC$ — площадь под $PR$-кривой:

- При вычислении точности нормирование — не по объему класса, а по **числу срабатываний** алгоритма, при изменении баланса классов значение точности, а значит и $AUC\text{-}PRC$ **изменится**.
- Значение $AUC\text{-}PRC$ для **идеального** классификатора зависит от баланса классов.
- Значение $AUC\text{-}PRC$ позволяет выявить недостатки модели в случае **несбалансированных** данных.
