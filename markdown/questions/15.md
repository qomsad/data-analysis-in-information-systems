# 15. Метрики качества модели регрессии: MAE, MSE, коэффициент детерминации, квантильная ошибка. Вероятностный смысл метрик. [[⇧]](../questions-list.md)

## Среднеквадратичная ошибка $MSE$

$$
MSE(a,X) = \frac{1}{n}∑_{i-1}^{n}(a(x_i) - y_i)^2
$$

## Абсолютная ошибка $MAE$

$$
MAE(a,X) = \frac{1}{n}∑_{i-1}^{n}|a(x_i) - y_i|
$$

## Коэффициент детерминации $R^2$

**Коэффициент детерминации** показывает, какую долю дисперсии (разнообразия ответов) в целевом векторе $y$ смогла объяснить (предсказать) модель:

$$
R^2(a,X) = 1 - \frac{∑_{i=1}^{n} (a(x_i) - y_i)^2}{∑_{i=1}^{n} (y_i - \overline{y})^2}
$$

$$
\overline{y}=\frac{1}{n}∑_{i=1}^{n}y_i
$$

$\overline{y}$ – средний ответ.

Свойства коэффициента детерминации:

- Для **разумных** моделей: $0 \le R^2 \le 1$
- Для **идеальной** модели: $R^2 = 1$
- Для **константной** модели: $R^2 = 0$ (всегда предсказывает средний ответ по выборке).
- В **случае**: $R^2 < 0$ модель хуже константной (нет смысла рассматривать).

## Квантильная ошибка

Все рассмотренные выше метрики — **симметричные**, одинаково «штрафуют» случаи $a(x) < y$ **«недопрогноз»** и $a(x) > y$ **«перепрогноз»**, существуют задачи где эти типы ошибок имеют разную цену.

**Квантильная функция ошибки**:

$$
\rho_{\tau} = \frac{1}{n} ∑_{i=1}^{n} \left( (\tau - 1 ) \cdot [y_i < a(x_i)] + \tau \cdot [y_i > a(x_i)]\right) \cdot |y_i-a(x_i)|
$$

$$
[y_i < a(x_i)] = \begin{cases}
1, \quad y_i < a(x_i) \\
0, \quad y_i \ge a(x_i) \end{cases}
$$

$$
[y_i > a(x_i)] = \begin{cases}
1, \quad y_i > a(x_i) \\
0, \quad y_i \le a(x_i) \end{cases}
$$

Для каждого объекта $x_i$, отклонение $|y_i-a(x_i)|$ умножается либо на $\tau$, если $y_i > a(x_i)$, либо на $1-\tau$, если $y_i > a(x_i)$.

Параметр $\tau \in [0, 1]$ определяет величину штрафа за «недопрогноз» и «перепрогноз»:

- Значение близкое к $1$, «штраф» больше за **«недопрогноз»**
- Значение близкое к $0$, «штраф» больше за **«перепрогноз»**

## Вероятностный смысл метрик

`Предположим`: один и тот же объект $x$ (с одними и теми же признаками) повторяется в выборке $n$ раз, при этом на каждом из повторов свой ответ $y_1, y_2, \ldots, y_n$ (например результаты нескольких измерений одного объекта).

`Заметим`: модель должна для одного и того же признакового описания давать одинаковый прогноз.

`Вопрос`: какой прогноз будет оптимальным для $x$:

- С точки зрения $MSE$: **среднее значение** по выборке $y_1, y_2, \ldots, y_n$.
- С точки зрения $MAE$: **медиана** по выборке $y_1, y_2, \ldots, y_n$.
- С точки зрения квантильной ошибки: $\tau$-квантиль.
